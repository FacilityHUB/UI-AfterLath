local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")

local function CreateUI()
    local UI = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local UICorner = Instance.new("UICorner")

    UI.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
    MainFrame.Size = UDim2.new(0, 300, 0, 400)
    MainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    UICorner.Parent = MainFrame
    MainFrame.Parent = UI

    -- Function to toggle UI visibility
    local function toggleUI()
        MainFrame.Visible = not MainFrame.Visible
    end

    -- Detect when the player presses the Ctrl key
    UIS.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.LeftControl or input.KeyCode == Enum.KeyCode.RightControl then
            toggleUI()
        end
    end)

    local function CreateTab(title)
        local TabFrame = Instance.new("Frame")
        TabFrame.Size = UDim2.new(1, 0, 1, 0)
        TabFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

        local TabLabel = Instance.new("TextLabel")
        TabLabel.Size = UDim2.new(1, 0, 0, 30)
        TabLabel.Text = title
        TabLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        TabLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        TabLabel.Parent = TabFrame

        TabFrame.Parent = MainFrame

        return {
            CreateToggle = function(params)
                local ToggleFrame = Instance.new("Frame")
                local ToggleLabel = Instance.new("TextLabel")
                local ToggleButton = Instance.new("TextButton")

                ToggleFrame.Size = UDim2.new(1, 0, 0, 50)
                ToggleFrame.Position = UDim2.new(0, params.PosX, 0, params.PosY + 30)
                ToggleFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

                ToggleLabel.Size = UDim2.new(0.8, 0, 1, 0)
                ToggleLabel.Text = params.Name
                ToggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                ToggleLabel.Parent = ToggleFrame

                ToggleButton.Size = UDim2.new(0.2, 0, 1, 0)
                ToggleButton.Text = "Off"
                ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)

                local isToggled = false

                ToggleButton.MouseButton1Click:Connect(function()
                    isToggled = not isToggled
                    ToggleButton.Text = isToggled and "On" or "Off"
                    ToggleButton.BackgroundColor3 = isToggled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
                    params.Callback(isToggled)
                end)

                ToggleFrame.Parent = TabFrame
                ToggleButton.Parent = ToggleFrame
            end,

            CreateInput = function(params)
                local InputFrame = Instance.new("Frame")
                local InputLabel = Instance.new("TextLabel")
                local InputBox = Instance.new("TextBox")

                InputFrame.Size = UDim2.new(1, 0, 0, 50)
                InputFrame.Position = UDim2.new(0, params.PosX, 0, params.PosY + 30)
                InputFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

                InputLabel.Size = UDim2.new(1, 0, 0, 20)
                InputLabel.Text = params.Name
                InputLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                InputLabel.Parent = InputFrame

                InputBox.Size = UDim2.new(1, 0, 1, -20)
                InputBox.Position = UDim2.new(0, 0, 0, 20)
                InputBox.PlaceholderText = params.PlaceholderText
                InputBox.TextColor3 = Color3.fromRGB(255, 255, 255)
                InputBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
                InputBox.ClearTextOnFocus = params.RemoveTextAfterFocusLost

                InputBox.Changed:Connect(function()
                    if InputBox.Text ~= "" then
                        params.Callback(InputBox.Text)
                    end
                end)

                InputFrame.Parent = TabFrame
                InputBox.Parent = InputFrame
            end
        }
    end

    local Tab1 = CreateTab("Tab Example")

    return {
        CreateTab = CreateTab,
        MainFrame = MainFrame
    }
end

return CreateUI
